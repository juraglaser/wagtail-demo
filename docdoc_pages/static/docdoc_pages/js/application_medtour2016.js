(function(){var e,o,n;e=function(){function e(){}return e.prototype.clear=function(){return console.log("Clearing Mixpanel cookies")},e}(),n=function(){function e(e){console.log(e)}return e.prototype.set=function(e,o){return console.log(e),o&&"function"==typeof o?o():void 0},e.prototype.set_once=function(e,o){return console.log("Set People ONCE"),console.log(e),o&&"function"==typeof o?o():void 0},e.prototype.increment=function(e,o){return null==o&&(o=1),console.log("Add "+o+" to "+e)},e}(),o=function(){function o(){}return o.prototype.people=new n(1),o.prototype.track=function(e,o,n){return console.log(e),console.log(o),n&&"function"==typeof n?n():void 0},o.prototype.identify=function(e){return console.log(e),this.people=new n(e)},o.prototype.alias=function(e){return console.log("Aliasing to new id "+e)},o.prototype.register=function(e){return console.log("Mixpanel Register"),console.log(e)},o.prototype.cookie=new e,o}(),window.mixpanel=new o}).call(this),function(){$(function(){return $(".booking-controller").ready(function(){return BookingUtils.setupCurrentBooking($(this)),BookingController.init(),BookingController.readHash(),$("#booking-reset-password-form").submit(function(e){return e.preventDefault(),e.stopPropagation(),BookingController.resetPassword()}),$("#mobile-booking-register-form").submit(function(e){return e.preventDefault(),e.stopPropagation(),BookingController.registerUser("#mobile-booking-register-form")}),$("#booking-login-form").submit(function(e){return e.preventDefault(),e.stopPropagation(),BookingController.login()}),$(".page-jump").click(function(e){var o;return e.preventDefault(),e.stopPropagation(),o=$(this).data("target-page"),BookingController.goToPage("#"+o)}),$("[create-lead]").blur(function(){return BookingUtils.createUserLead($(this).val()),BookingUtils.createBookingLead($(this).val())})}),$(".landing-booking-controller").ready(function(){return MedLandingBookingUtils.setupCurrentBooking($(this)),$(".register-user-btn").click(function(e){var o;return e.preventDefault(),e.stopPropagation(),o=$(this).parents("form"),MedLandingBookingUtils.registerUser("#"+o.prop("id"))}),$("#user-enquiry-form #user_email").blur(function(){return MedLandingBookingUtils.createLead()})}),$(".show-pin-hint").click(function(e){return e.preventDefault(),e.stopPropagation(),$(".pin-hint").toggleClass("hidden")}),$(window).on("hashchange",function(){return BookingController.readHash()})})}.call(this),function(){var e=[].indexOf||function(e){for(var o=0,n=this.length;n>o;o++)if(o in this&&this[o]===e)return o;return-1};this.BookingController=function(){function o(){}return o.currentFormId="",o.user=null,o.smsConfirmed=!1,o.bookingParams={},o.registerUser=function(n){var t,i;return o.currentFormId=n,BookingUtils.clearErrors(),e.call(document.createElement("input"),"placeholder")<0&&(t=$(o.currentFormId),t.find(".required").not(".form-group-hidden .required").each(function(){return $(this).val()===$(this).attr("placeholder")?$(this).val(""):void 0})),i={layout:BookingUtils.currentBooking.layout,specialty:$("#specialty-data").text(),user_logged_in:window.isLoggedin},window.location.href.indexOf("/booking")>-1?(i.booking_page_version="v2",mixpanel.track("Booking Form Filled out",i)):(i.enquiry_page_version="v2",mixpanel.track("Enquiry Form Filled out",i)),BookingUtils.submitForm(o.currentFormId,o.registrationSuccess,o.registrationError)},o.registrationSuccess=function(e){var n,t,i,r,a;return a=e.user,i=a.user_name.split(" ")[0],r=a.user_name.split(" ")[1],o.user=a,mixpanel.alias(""+a.id),mixpanel.people.set({$first_name:i,$last_name:r,$email:a.user_email,$phone:a.user_phone,"Country code":a.user_phone_prefix,Location:$(o.currentFormId).data("location"),Specialty:$(o.currentFormId).data("specialty"),Booked:"false"}),mixpanel.track("Details Filled out - Long",{layout:BookingUtils.currentBooking.layout}),$(".form_input #appointment_date").is("input")&&(n=$(".form_input #appointment_date").val(),t=moment(n),"id-ID"===$("html").attr("lang")?t.locale("id"):t.locale("en"),$(".sidebar.confirmation-info .visit-date").html(t.format("dddd, MMMM Do, YYYY")),$(".sidebar.confirmation-info").show()),o.smsConfirmed=a.sms_confirmed,o.makeMedtourAppointment()},o.registrationError=function(e){return o.goToPage("#details"),BookingUtils.displayErrors(o.currentFormId,e.errors)},o.validateAppointmentData=function(e,o){var n;return n=!1,""===$(e).val()?(setTimeout(function(){var o;return o=$(e).parent(),o.find(".error-field").remove(),o.addClass("with-error-field"),$(e).addClass("has-error-field"),$("<div class='error-field'>"+window.t("this_field_is_required")+"</div>").insertAfter($(e))},2),n=!0):($(e).parent().find(".error-field").remove(),$(e).removeClass("has-error-field")),""===$(o).val()?(setTimeout(function(){var e;return e=$(o).parent(),e.find(".error-field").remove(),e.addClass("with-error-field"),$(o).addClass("has-error-field"),$("<div class='error-field'>"+window.t("this_field_is_required")+"</div>").insertAfter($(o))},2),n=!0):($(o).parent().find(".error-field").remove(),$(o).removeClass("has-error-field")),n},o.setAppointmentData=function(){var e,n;return o.validateAppointmentData("#appointment_date_form","#appointment_time_form")?!1:o.smsConfirmed?o.goToConfirmationPage():($(".form_input #appointment_date_form").is("input")&&(e=$(".form_input #appointment_date_form").val(),n=moment(e),"id-ID"===$("html").attr("lang")?n.locale("id"):n.locale("en"),$(".sidebar.confirmation-info .visit-date").html(n.format("dddd, MMMM Do, YYYY")),$(".sidebar.confirmation-info").show()),o.makeMedtourAppointment())},o.emptyPhone=function(){return""===$("#user_phone").val(),BookingUtils.bindErrorsEvent()},o.showRegistrationForm=function(){return BookingUtils.clearErrors(),o.showRegisterForm()},o.showForgotPasswordForm=function(){return BookingUtils.clearErrors(),o.showForm("#forgot-password")},o.showLoginForm=function(){return BookingUtils.clearErrors(),o.showForm("#login")},o.loginSuccess=function(e){return mixpanel.identify(""+e.user.id),window.location.reload()},o.loginError=function(){var e,o;return BookingUtils.clearErrors(),e=$("#booking-login-form"),e.find("#user_password").addClass("has-error-field"),e.find("#user_email").addClass("has-error-field"),o=$(".invalid-email-password-text").text(),$("<div class='error-field'>"+o+"</div>").insertAfter(e.find("#user_password"))},o.login=function(){return BookingUtils.submitForm("#booking-login-form",o.loginSuccess,o.loginError)},o.resetPassword=function(){var e,n;return n=$("#booking-reset-password-form"),n.find(".success-sent").remove(),e=o,BookingUtils.clearErrors(),BookingUtils.submitForm("#booking-reset-password-form",function(){var o;return o=$(".reset-sent-text").text(),n.find("#user_email").removeClass("has-error-field"),$("<div class='success-sent'>"+o+"</div>").insertAfter(n.find("#user_email")),n.find(".btn-primary").addClass("hidden"),setTimeout(function(){return e.goToPage("#login")},1200)},function(){var e;return e=$(".invalid-email-text").text(),n.find("#user_email").addClass("has-error-field"),$("<div class='error-field'>"+e+"</div>").insertAfter(n.find("#user_email"))})},o.showVerifyPhoneForm=function(){return o.showForm("#verify-phone")},o.verifyPhoneSuccess=function(){return o.smsConfirmed=!0,mixpanel.track("Phone Number Verified - Long",{layout:BookingUtils.currentBooking.layout}),o.makeMedtourAppointment()},o.confirmPhone=function(e){var n;return BookingUtils.clearErrors(),n=o,BookingUtils.submitForm(e,o.verifyPhoneSuccess,function(){var o,t;return o=$(e),n.goToPage("#phone"),t=$(".invalid-pin-error").text(),$("<div class='error-field'>"+t+"</div>").insertAfter(o.find("#sms-code-field")),o.find("#sms-code-field").addClass("has-error-field"),BookingUtils.hideLoadingForm()},!0,!1)},o.makeMedtourAppointment=function(){var e,n,t,i,r,a,s;return $("#recaptcha_response_field").length>0&&(r=$("#recaptcha_response_field").val(),a=$("#recaptcha_challenge_field").val()),$("#appointment_date").length>0?($("#appointment").length>0?(e=$(".form_input #appointment_date_form").val(),n=$(".form_input #appointment_time_form").val(),i=$(".form_input #procedure_form").val()):(e=$(".form_input #appointment_date").val(),n=$(".form_input #appointment_time").val(),i=$(".form_input #procedure").val()),s=-(new Date).getTimezoneOffset()/60,n+=s>0?" +"+s:" -"+s):(e=null,n=null,i=$("#procedure_name_id").val()),o.bookingParams.appointment_date&&(e=o.bookingParams.appointment_date.replace(/%20/g," "),o.bookingParams.appointment_time&&(n=o.bookingParams.appointment_time.replace(/%20/g," ")),i=o.bookingParams.reason_id?o.bookingParams.reason_id.replace(/%20/g," "):"",s=-(new Date).getTimezoneOffset()/60,o.bookingParams.appointment_time&&(n+=s>0?" +"+s:" -"+s)),t={recaptcha_response_field:r,recaptcha_challenge_field:a,medtour_enquiry_id:BookingUtils.currentBooking.medTourLeadId,appointment_date:e,appointment_time:n,procedure_name_id:i},$("#info_page_id").length>0&&(t.is_med_info_page=!0,t.med_info_page_id=$("#info_page_id").html()),BookingUtils.showLoadingForm(),$.ajax({method:"POST",url:BookingUtils.currentBooking.redirectUrl+"/create_medtour_lead.json",data:t}).success(function(e){return e.success?(BookingUtils.currentBooking.medTourLeadId=e.appointment_id,mixpanel.alias(""+o.user.id),mixpanel.people.set({Booked:"infoEnquiry"!==BookingUtils.currentBooking.page,"URL slug":BookingUtils.currentBooking.redirectUrl}),o.goToMedtourSuccessPage(e.appointment_id)):"Wrong captcha"===e.errors[0]?(alert(e.errors[0]),window.location.reload()):window.location.path=BookingUtils.currentBooking.redirectUrl})},o.showPhoneEditForm=function(){return $("#user_phone_prefix option[value='"+o.user.user_phone_prefix+"']").prop("selected",!0),$("#booking-update-phone-form .user-phone-field").removeClass("has-error-field").val(""+(o.user.user_phone||"")).next(".error-field").remove(),o.showForm("#edit-phone")},o.goToMedtourSuccessPage=function(e){var n,t,i,r,a,s,l,c,d,u;return o.showSuccessLoadingStep(),"infoEnquiry"===BookingUtils.currentBooking.page?(s=$("#info_page_type").text(),l="/thankyou?step="+s+"#success"):l=-1===window.location.pathname.indexOf("enquiry")&&-1===window.location.pathname.indexOf("booking")?window.location.pathname.replace(/\/$/,"")+"/enquiry-success?enquiry_id="+e+"#success":window.location.pathname.replace(/\/$/,"")+"-success?enquiry_id="+e+"#success","infoEnquiry"===BookingUtils.currentBooking.page?(mixpanel.track("Topic Enquiry Success",{layout:BookingUtils.currentBooking.layout,topic_page_type:s,user_logged_in:"yes",topic_page_version:"v1"}),mixpanel.track("Conversion",{"conversion type":"Enquiry",url:window.location.href,layout:BookingUtils.currentBooking.layout,version:2}),mixpanel.people.increment("number of enquiries done"),mixpanel.people.increment("number of conversions"),i=new Date,r=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),0),mixpanel.people.set({"last conversion":r.toISOString()})):(a={layout:BookingUtils.currentBooking.layout,specialty:$("#specialty-data").text(),user_logged_in:"yes"},d="Enquiry Success","booking"===BookingUtils.currentBooking.page?(a.booking_page_version="v1",d="Booking Success",n="Booking",t="number of bookings done"):(n="Enquiry",t="number of enquiries done",a.enquiry_page_version="v1"),mixpanel.track(d,{layout:BookingUtils.currentBooking.layout,specialty:$("#specialty-data").text(),user_logged_in:"yes",page_version:"v2"}),u=2,mixpanel.track("Conversion",{"conversion type":n,url:window.location.href,layout:BookingUtils.currentBooking.layout,version:u}),mixpanel.people.increment(t),mixpanel.people.increment("number of conversions"),i=new Date,r=new Date(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),0),mixpanel.people.set({"last conversion":r.toISOString()})),c=setTimeout(function(){return window.location.href=l},500)},o.sendingPin=function(){return $(".resend-pin").html($(".sending-text").text())},o.doneSendingPin=function(){return $(".resend-pin").html($(".resend-error-text").text())},o.sendSmsConfirmation=function(){return BookingUtils.sendSmsConfirmation(!0,o.sendingPin,o.doneSendingPin)},o.updatePhoneSuccess=function(e){return delete e.success,o.user=e,o.firstTimeUserPhoneEdit=!1,BookingUtils.sendSmsConfirmation(),BookingUtils.clearErrors(),o.goToPage("#phone")},o.updatePhoneError=function(){var e,o;return e=$("#booking-update-phone-form"),BookingUtils.clearErrors(),o=$(".invalid-phone-error").text(),e.find("#user_phone").addClass("has-error-field"),$("<div class='error-field'>"+o+"</div>").insertAfter(e.find("#user_phone"))},o.updatePhoneNumber=function(e){var n;return n=$(e),""!==n.find("#user_phone_prefix").val()&&"+"!==n.find("#user_phone_prefix").val()||n.find("#user_phone_prefix").val("+65"),n.find("#user_phone_prefix").val().match(/^\s*\+/)||n.find("#user_phone_prefix").val("+"+n.find("#user_phone_prefix").val()),BookingUtils.submitForm(e,o.updatePhoneSuccess,o.updatePhoneError,!0)},o.validateEnquiryForm=function(){var e,o;return o=!1,e=$("#enquiry .form-book-primary"),e.find(".required").not(".form-group-hidden .required").each(function(){return this.value&&$(this).val()!==$(this).attr("placeholder")?$(this).removeClass("error").parent().removeClass("error"):(o=!0,$(this).addClass("error").parent().addClass("error"))}),e.find(".radio-required").each(function(){return $(this).find("input").is(":checked")?$(this).closest(".form-controls").removeClass("error"):(o=!0,$(this).closest(".form-controls").addClass("error"))}),o||(e.parent().addClass("expanded"),e.find(".field").not(".form-group-hidden .field").parent().removeClass("error").addClass("success"),e.find(".radio").closest(".form-controls").removeClass("error").addClass("success")),o},o.makeEnquiry=function(){return o.validateEnquiryForm()?!1:o.user?o.user.sms_confirmed?o.makeMedtourAppointment():(o.activateStep2(),o.goToPage("#phone"),o.sendSmsConfirmation()):void 0},o.resendPin=function(){return o.sendSmsConfirmation()},o.confirmBooking=function(){return o.activateStep3(),$(".booking-page-confirmed").length>0?mixpanel.track("Booking Confirmed",{layout:BookingUtils.currentBooking.layout}):mixpanel.track("Enquiry Confirmed",{layout:BookingUtils.currentBooking.layout}),o.makeMedtourAppointment()},o.hideAllForms=function(){return $(".booking-step").addClass("hidden")},o.activateStep1=function(){return $(".step").removeClass("active"),$(".step1").addClass("active"),$(".step-cta").addClass("hidden"),$(".step1-cta").removeClass("hidden")},o.activateStep2=function(){return $(".step").removeClass("active"),$(".step2").addClass("active"),$(".step-cta").addClass("hidden"),$(".step2-cta").removeClass("hidden")},o.activateStep3=function(){return $(".step").removeClass("active"),$(".step3").addClass("active"),$(".step-cta").addClass("hidden"),$(".step3-cta").removeClass("hidden")},o.showForm=function(e){return o.hideAllForms(),$(e).removeClass("hidden"),$(e).find(".hidden").removeClass("hidden")},o.showRegisterForm=function(){return o.showForm("#register")},o.showAppointmentForm=function(){return o.showForm("#appointment")},o.showEnquiryForm=function(){return o.showForm("#enquiry")},o.goToPage=function(e){return BookingUtils.hideLoadingForm(),window.location.hash=e},o.readDetailsPage=function(){var e;return o.user?window.location.href=BookingUtils.currentBooking.redirectUrl:(e="details",window.location.href.indexOf("info/specialty")>-1&&(e="specialty-enquiry"),window.location.href.indexOf("info/procedure")>-1&&(e="procedure-enquiry"),window.location.href.indexOf("info/condition")>-1&&(e="condition-enquiry"),window.location.href.indexOf("info/body")>-1&&(e="body-enquiry"),window.location.href.match("step="+e)?(o.activateStep1(),o.showRegisterForm()):window.location.href.indexOf("/enquiry")>-1?window.location.href=window.location.pathname+("?step="+e+"#details"):(o.activateStep1(),o.showEnquiryForm()))},o.readAppointmentPage=function(){return window.location.href.match("step=appointment")?(o.activateStep1(),o.showAppointmentForm()):window.location.href=window.location.pathname+"?step=appointment#appointment"},o.readEnquiryPage=function(){var e;return e="enquiry",window.location.href.indexOf("info/specialty")>-1&&(e="specialty-enquiry"),window.location.href.indexOf("info/procedure")>-1&&(e="procedure-enquiry"),window.location.href.indexOf("info/condition")>-1&&(e="condition-enquiry"),window.location.href.indexOf("info/body")>-1&&(e="body-enquiry"),window.location.href.indexOf("/enquiry")>-1?window.location.href=window.location.pathname+("?step="+e+"#enquiry"):(o.activateStep1(),o.showEnquiryForm())},o.readPhonePage=function(){var e;return e="phone",window.location.href.indexOf("info/specialty")>-1&&(e="specialty-phone"),window.location.href.indexOf("info/procedure")>-1&&(e="procedure-phone"),window.location.href.indexOf("info/condtion")>-1&&(e="condition-phone"),window.location.href.indexOf("info/body")>-1&&(e="body-phone"),window.location.href.match("step="+e)?(trackVeficationPage(),o.user.user_phone&&""!==o.user.user_phone?(o.showVerifyPhoneForm(),o.activateStep2()):(o.goToPage("#edit-phone"),o.firstTimeUserPhoneEdit=!0)):window.location.href=window.location.pathname+("?step="+e+"#phone")},o.readConfirmPage=function(){return window.location.href.match("step=confirm")?(o.showForm("#confirm"),o.activateStep2()):o.makeMedtourAppointment()},o.readHash=function(){return"#details"===window.location.hash?o.readDetailsPage():"#appointment"===window.location.hash?o.readAppointmentPage():"#enquiry"===window.location.hash?o.readEnquiryPage():"#login"===window.location.hash?mixpanel.track("Login link clicked",{layout:BookingUtils.currentBooking.layout,page_version:"v2",specialty:$("#specialty-data").text(),user_logged_in:"no"},function(){return o.activateStep1(),o.showLoginForm()}):"#forgot-password"===window.location.hash?(o.activateStep1(),o.showForgotPasswordForm()):"#edit-phone"===window.location.hash?(o.activateStep2(),o.showPhoneEditForm()):"#phone"===window.location.hash?o.readPhonePage():"#confirm"===window.location.hash?o.readConfirmPage():void 0},o.goToConfirmationPage=function(){return o.confirmBooking()},o.setHash=function(){var e,n,t,i;if(location.search){for(t=location.search.substring(1).split("&"),e=0,i=[];e<t.length;)n=t[e].split("="),n[0]?(o.bookingParams[n[0]]=n[1]||!0,i.push(e++)):e++;return i}},o.init=function(){return o.user=window.dataTransfer.user,o.setHash(),o.user?$("#medtour-booking").length>0?o.makeMedtourAppointment():o.user.sms_confirmed?0===$("#appointment").length?$("#enquiry").length>0?window.location.href.match("step=phone")||window.location.href.match("step=specialty-phone")||window.location.href.match("step=condition-phone")||window.location.href.match("step=procedure-phone")||window.location.href.match("step=body-phone")?o.goToPage("#phone"):window.location.href.match("step=confirm")?o.goToPage("#confirm"):(o.activateStep1(),o.goToPage("#enquiry")):o.goToConfirmationPage():window.location.href.match("step=phone")||window.location.href.match("step=specialty-phone")||window.location.href.match("step=condition-phone")||window.location.href.match("step=procedure-phone")||window.location.href.match("step=body-phone")?o.goToPage("#phone"):window.location.href.match("step=confirm")?o.goToPage("#confirm"):o.goToPage("#appointment"):0===$("#appointment").length?$("#enquiry").length>0?window.location.href.match("step=phone")||window.location.href.match("step=specialty-phone")||window.location.href.match("step=condition-phone")||window.location.href.match("step=procedure-phone")||window.location.href.match("step=body-phone")?o.goToPage("#phone"):window.location.href.match("step=confirm")?o.goToPage("#confirm"):(o.activateStep1(),o.goToPage("#enquiry")):(o.activateStep2(),o.goToPage("#phone"),o.sendSmsConfirmation()):(o.activateStep1(),window.location.href.match("step=phone")||window.location.href.match("step=specialty-phone")||window.location.href.match("step=condition-phone")||window.location.href.match("step=procedure-phone")||window.location.href.match("step=body-phone")?o.goToPage("#phone"):window.location.href.match("step=confirm")?o.goToPage("#confirm"):o.goToPage("#appointment")):window.location.href.indexOf("/enquiry")>-1||window.location.href.indexOf("/booking")>-1?(o.activateStep1(),o.goToPage("#details")):void 0},o.showSuccessLoadingStep=function(){return o.hideAllForms(),$("#success-loading").removeClass("hidden")},o}()}.call(this),function(){this.BookingUtils=function(){function e(){}return e.smsSent=!1,e.currentBooking={},e.setupCurrentBooking=function(e){return this.currentBooking.redirectUrl=e.data("redirect-url"),this.currentBooking.page=e.data("page"),this.currentBooking.layout=this.isMobile?"Mobile":"Desktop",this.currentBooking.location=$("#mobile-booking-register-form").data("location"),this.currentBooking.specialty=$("#mobile-booking-register-form").data("specialty"),this.bookingSetup(this.currentBooking.layout,this.currentBooking.page)},e.bookingSetup=function(){var e;return e={layout:layout,user_logged_in:window.isLoggedin},"infoEnquiry"===this.currentBooking.page?(e.topic_enquiry_page_version="v1",e.topic_page_type=$("#info_page_type").text(),mixpanel.track("Topic Enquiry page loaded",e)):"booking"===this.currentBooking.page?(e.booking_page_version="v2",e.specialty=$("#specialty-data").text(),mixpanel.track("Booking page loaded",e)):(e.enquiry_page_version="v2",e.specialty=$("#specialty-data").text(),mixpanel.track("Enquiry page loaded",e)),window.location.href.match(/\?step=/)&&window.location.href.match(/#details/)?window.MixpanelUtils.trackMixpanelForm("booking"===this.currentBooking.page):void 0},e.createBookingLead=function(e){return e&&""!==e?$.ajax({method:"POST",url:this.currentBooking.redirectUrl+"/create_medtour_lead.json",data:{email:e,medtour_enquiry_id:this.currentBooking.medTourLeadId}}).success(function(e){return function(o){return o.success?e.currentBooking.medTourLeadId=o.appointment_id:void 0}}(this)):void 0},e.createUserLead=function(e){return $.ajax({method:"POST",url:"/users/create_lead",data:{user:{email:e}}}).success(function(o){return function(n){var t;return t=n.user,mixpanel.alias(""+t.id),mixpanel.people.set({$email:e,Location:o.currentBooking.location,Specialty:o.currentBooking.specialty,Booked:"false"})}}(this))},e.clearErrors=function(){return $(".has-error-field").removeClass("has-error-field"),$(".error-field").remove()},e.bindErrorsEvent=function(){return $(".has-error-field").focus(function(){return $(this).next(".error-field").remove(),$(this).removeClass("has-error-field")})},e.displayErrors=function(e,o){var n,t,i,r,a;this.clearErrors(),t=$(e);for(r in o)i=o[r],n=t.find("#user_"+r),n.addClass("has-error-field"),a=n.parent(),a.hasClass("select")?($("<div class='error-field'>"+i[0]+"</div>").insertAfter(a),a.addClass("has-error-field")):$("<div class='error-field'>"+i[0]+"</div>").insertAfter(n);return this.bindErrorsEvent()},e.showLoadingForm=function(){return $(".btn-warning:visible").each(function(){var e;return e=$(this).innerWidth(),$("<a class='btn btn-warning with-spinner disabled' style='width: "+e+"px;'><div class='spinner'></div></a>").insertAfter($(this))}),$(".btn-primary:visible").each(function(){var e;return e=$(this).innerWidth(),$("<a class='btn btn-primary with-spinner disabled' style='width: "+e+"px;'><div class='spinner'></div></a>").insertAfter($(this))}),$("form input").prop("disabled",!0)},e.hideLoadingForm=function(){return $("form input").prop("disabled",!1),$(".with-spinner").remove()},e.submitForm=function(e,o,n,t,i){var r,a,s;return null==t&&(t=!1),null==i&&(i=!0),a=$(e),r=a.serializeHash(),s=t?"PUT":a.attr("method"),this.showLoadingForm(),$.ajax({method:s,url:a.prop("action"),data:r}).success(function(e){return function(t){return t.success?o&&o(t):n&&n(t),i?e.hideLoadingForm():void 0}}(this)).error(function(e){return function(o){return n&&n(o),i?e.hideLoadingForm():void 0}}(this))},e.sendSmsConfirmation=function(e,o,n){return e||!this.smsSent?(this.smsSent=!0,o&&o(),this.showLoadingForm(),$.ajax({url:"/users/send_sms_confirmation.json",method:"POST",data:{authenticity_token:window.authenticityToken()}}).success(function(e){return function(){return e.hideLoadingForm(),n?n():void 0}}(this)).error(function(e){return function(){return e.hideLoadingForm(),n&&n(),e.smsSent=!1}}(this))):void 0},e}()}.call(this),function(){this.MedLandingBookingUtils=function(){function e(){}return e.smsSent=!1,e.currentBooking={},e.setupCurrentBooking=function(e){return this.currentBooking.landingPageId=e.data("landingpageid"),this.currentBooking.version=e.data("version"),this.currentBooking.isMobile=e.data("ismobile"),this.currentBooking.layout=this.isMobile?"Mobile":"Desktop",this.currentBooking.fromEnquiry=!1,this.currentBooking.landing_page_topic=e.data("landingpagetopic"),this.currentBooking.landing_page_type=e.data("landingpagetype"),this.currentBooking.pageType="medicaltravel",this.currentBooking.layout_version=2,this.currentBooking.landingPageId="",this.currentBooking.medTourLeadId="",this.bookingSetup(this.currentBooking.layout,this.currentBooking.page)},e.bookingSetup=function(){var e,o,n,t,i,r;return this.currentBooking.fromEnquiry&&mixpanel.track("Landing page "+this.currentBooking.version+" - load form button clicked",{layout:this.currentBooking.layout}),r={layout:this.currentBooking.layout,landing_page_version:this.currentBooking.version,landing_page_topic:this.currentBooking.landing_page_topic,landing_page_type:this.currentBooking.landing_page_type,user_logged_in:window.isLoggedin},mixpanel.track("Regional page loaded",r),i="none",e="none",n=window.dataTransfer.current_utm,n&&(i=n.split(".")[4],e=n.split(".")[5]),mixpanel.track("Regional enquiry landing",{"form page type":"Regional enquiry landing",keyword:i,"ad group":i,url:window.location.href,version:this.currentBooking.layout_version,layout:this.currentBooking.layout}),mixpanel.people.increment("regional_inquiry_landing_visited"),o=new Date,t=new Date(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate(),o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),0),mixpanel.people.set({"last regional inquiry landing visited":t.toISOString(),keyword:i,"ad group":e})},e.createLead=function(){var o;return o=$(".form-register #user_email").val(),o&&""!==o?(BookingUtils.createUserLead(o),e.createMedtourLead(o)):void 0},e.createMedtourLead=function(o){return $.ajax({method:"POST",url:"/create_medtour_lead.json",data:{patient_enquiry:"",email:o,medtour_enquiry_id:null}}).success(function(o){return o.success?e.currentBooking.medTourLeadId=o.appointment_id:void 0})},e.registerUser=function(o){return BookingUtils.submitForm(o,e.registrationSuccess,e.registrationError,!1,!1)},e.registrationSuccess=function(o){var n,t,i,r,a,s;return window.location.href.toLowerCase().indexOf("utm_source=adwords")>-1&&mixpanel.track("Adwords lead created",{layout:e.currentBooking.layout}),s=o.user,i=s.user_name.split(" ")[0],r=s.user_name.split(" ")[1],mixpanel.alias(""+s.user_id),a={landing_page:e.currentBooking.landingPageId,email:o.user.user_email,medtour_enquiry_id:e.currentBooking.medTourLeadId},$("#info_page_id").length>0&&(a.is_med_info_page=!0,a.med_info_page_id=$("#info_page_id").html()),$("#patient_enquiry").is("input")&&(a.patient_enquiry=$("#patient_enquiry").val()),mixpanel.people.set({$first_name:i,$last_name:r,$email:s.user_email,$phone:s.user_phone,"Country code":s.user_phone_prefix,Booked:"false",landing_page_slug:e.currentBooking.landingPageId,landing_page_version:e.currentBooking.version}),mixpanel.track("Conversion",{"conversion type":"Regional Landing",url:window.location.href,version:e.currentBooking.layout_version,layout:e.currentBooking.layout}),mixpanel.people.increment("number of regional enquiry"),mixpanel.people.increment("number of conversions"),n=new Date,t=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),0),mixpanel.people.set({"last conversion":t.toISOString()}),$.ajax({method:"POST",url:"/create_medtour_lead.json",data:a}).success(function(){var o;return o={layout:e.currentBooking.layout,landing_page_version:e.currentBooking.version,landing_page_topic:e.currentBooking.landing_page_topic,landing_page_type:e.currentBooking.landing_page_type,user_logged_in:window.isLoggedin},e.currentBooking.landing_page_type&&(o.landing_page_type=e.currentBooking.landing_page_type),mixpanel.track("Regional enquiry form submitted",o),$("#query_type").length&&$("#query_value").length?window.location.href="/query?query_type="+$("#query_type").val()+"&query_value="+$("#query_value").val()+"&selected_country="+$("#user_country").val()+"&success=true":window.location.href="/thankyou?step="+e.currentBooking.pageType+"#success"})},e.registrationError=function(e){return BookingUtils.clearErrors(),BookingUtils.hideLoadingForm(),BookingUtils.displayErrors("#user-enquiry-form",e.errors)},e}()}.call(this),function(){$(document).ready(function(){return $(".clinic-ab-2016").length>0?($(window).on("touchmove scroll",function(){var e;return e=$(".scroll-wrapper").offset().top-20,e<window.scrollY?$(".cta-bar").addClass("sticky"):$(".cta-bar").removeClass("sticky")}),$(".content-full").each(function(){var e,o,n;return o=$(this).html(),n=$.truncate(o,{length:200,words:!0,ellipsis:""}),n.length<o.length?(e=$(this).prev(".content-truncated"),$(this).addClass("show-truncated"),e.addClass("show-truncated"),$(n).prependTo(e),e.find("p:last").append(e.find(".read-more")),$(this).append(e.find(".read-less"))):void 0}),$(document).on("click",".read.read-more",function(){var e;return e=$(this).parents(".content").first(),e.find(".content-truncated").removeClass("show-truncated"),e.find(".content-full").removeClass("show-truncated")}),$(document).on("click",".read.read-less",function(){var e;return e=$(this).parents(".content").first(),e.find(".content-truncated").addClass("show-truncated"),e.find(".content-full").addClass("show-truncated")}),$(".scroll-group:first .scroll-group-head").addClass("active"),$(".scroll-group:first .scroll-group-body").show(),$(".widget-nav h6").on("click",function(){return $(this).parent(".widget-head").next(".widget-body").slideToggle(500),$(this).toggleClass("active")})):void 0})}.call(this),function(e,o,n,t){var i=e(o),r=e(n);r.ready(function(){e("img").unveil(),i.on("load",function(){if(e(".nav-dropdown-lang li.change-language").length&&e(".nav-dropdown-lang li.change-language a").on("click",function(){event.preventDefault();var n=e(".nav-dropdown-lang li.change-language")[0].dataset.url;o.location.href=n}),e(".intro-bg").length){var r=e(".intro-bg"),a=r.find("img").attr("data-src");r.css("background-image","url("+a+")")}if(e(".slider").length){var s=e(".slider-about .owl-carousel").owlCarousel({items:1,mouseDrag:!1,touchDrag:!1,smartSpeed:500,onInitialized:function(o){var n=e(".slider-about .slider-paging a"),t=e(o.target);n.on("click",function(o){o.preventDefault();var n=e(this).parent().index();e(this).parent().addClass("current").siblings().removeClass("current"),t.trigger("to.owl.carousel",[n,500])})}});s.on("changed.owl.carousel",function(o){var n=e(".slider-paging ul li");n.removeClass("current"),e(n[o.item.index]).addClass("current")}),e(".profile-slider .owl-carousel").owlCarousel({items:1,loop:!0,nav:!0,smartSpeed:500,autoHeight:!0}),e(".slider-testimonials .owl-carousel").owlCarousel({items:1,loop:!0,nav:!0,smartSpeed:500}),e(".slider-news .owl-carousel").owlCarousel({responsive:{0:{items:1},768:{items:4}},loop:!0,nav:!0,smartSpeed:500}),e(".slider-partners .owl-carousel").owlCarousel({responsive:{0:{items:1},768:{items:5}},loop:!0,nav:!0,smartSpeed:500}),e(".slider-members .owl-carousel").owlCarousel({items:1,loop:!0,nav:!0,smartSpeed:500,autoHeight:!0,onInitialized:function(o){var n=e(o.target).find(".owl-prev"),t=e(o.target).find(".owl-next"),i=e(o.target).find(".slide").eq(0).find("img").height();n.add(t).css("top",i)}})}if(i.width()<768&&(e(".tabs-primary .current").removeClass("current"),e(".tabs-primary .tab-inner-head").on("click",function(){e(this).toggleClass("active").closest(".tab").siblings().find(".tab-inner-head").removeClass("active"),e(this).next(".tab-inner").slideToggle().closest(".tab").siblings().find(".tab-inner").slideUp()})),e('<div class="nav-mobile"></div>').appendTo(e(".header .header-bottom .header-inner")),e(".header .nav").clone().addClass("cloned").appendTo(e(".nav-mobile")),e(".header .nav-utilities").clone().addClass("cloned").appendTo(e(".nav-mobile")),e(n).on("click",".nav-mobile .logout-link",function(){e(".nav-utilities .logout-link:first").click()}),e(".compare").length){var l=0;e(".compare-column .compare-item-head").each(function(){l<e(this).height()&&(l=e(this).height())}),e(".compare-column .compare-item-head").css("height",l);
for(var c=e(".compare .compare-column").length,d=e(".compare-column:first-child .compare-item .compare-item-row").length,u=0,p=0;d>p;p++){u=0;for(var f=0;c>f;f++)u<e(".compare-column").eq(f).find(".compare-item-row").eq(p).outerHeight()&&(u=e(".compare-column").eq(f).find(".compare-item-row").eq(p).outerHeight());e(".compare-column").each(function(){e(this).find(".compare-item-row").eq(p).css("height",u)})}}var g=e(".scroll-wrapper"),m=e(".scroll-group-head");e(".scroll-group-head:first-child").addClass("active"),g.find(".scoll-wrapper-inner").css("margin-top",0),m.on("click",function(){m.removeClass("active"),e(this).addClass("active");var o=e(this).attr("href");e("html, body").animate({scrollTop:e(o).offset().top},500)}),o.LC_API==t?e(".toggle-livechat").remove():e(".toggle-livechat").on("click",function(){o.LC_API.open_chat_window()})}),i.width()<768&&e(".form-book-primary").is("div")&&e(".form-book-primary .field").not(".user-phone-field").each(function(){e(this).attr("placeholder",e(this).parent(".form-controls").prev("label").text())}),e(".toggle-footer-bar").on("click",function(o){o.preventDefault(),e(this).parent().toggleClass("opened"),e(this).parent().prev(".footer-bar-content").slideToggle(),e("body, html").animate({scrollTop:9999},500)});var a=e(".wrapper").css("padding-top");e(".nav > ul > li").on("mouseenter",function(){var o=e(this),n=0;e(".intro-home").is("div")&&(n=100),e(".wrapper").css({"padding-top":function(){return o.find(".nav-dropdown-mega .shell").outerHeight()+o.find(".nav-dropdown-mega").offset().top-n}})}).on("mouseleave",function(){e(".wrapper").css({"padding-top":a})}),e(".accordion-filter .checkbox-lead input").on("change",function(){e(this).is(":checked")?e(this).closest("li").siblings().find("input").prop("checked",!0):e(this).closest("li").siblings().find("input").prop("checked",!1)}),e(".checkbox-alt-small input").on("change",function(){e(this).is(":checked")||e(this).closest(".accordion-body").find(".checkbox-lead input").prop("checked",!1)}),e(n).on("click",".reset",function(o){o.preventDefault(),e(".ais-current-refined-values--clear-all div").click()}),e(".popup-trigger").length&&e(".popup-trigger").magnificPopup({type:"inline",removalDelay:400,mainClass:"mfp-fade"}),e(".play-video").length&&e(".play-video").magnificPopup({type:"iframe",removalDelay:400,mainClass:"mfp-fade"}),e(".form-newsletter form").on("submit",function(o){var n=!1;e(this).find(".btn");if(o.preventDefault(),e(this).find(".field").each(function(){this.value&&e(this).val()!==e(this).attr("placeholder")||(n=!0,e(this).addClass("error").parent().addClass("error"))}),n);else{var t=null;e("#newsletter_med_info_page_id").size()>0&&(t=e("#newsletter_med_info_page_id").val());var i={newsletter:{name:e("#newsletter_name").val(),email:e("#newsletter_email").val(),med_info_page_id:t}},r=e(".form-newsletter form").attr("action");e.ajax(r,{type:"POST",data:i}).done(function(){e(".form-newsletter").find(".form-alert").addClass("show")}).fail(function(){alert("invalid data")})}}),e(".section-cta").not(".section-cta-inline").show(),e(".widget-cta").on("click",function(o){o.preventDefault(),e(".section-cta").addClass("active")}),e(".close-cta-section").on("click",function(o){o.preventDefault(),e(".section-cta").removeClass("active"),i.width()<768&&e("body, html").animate({scrollTop:0},500)}),e(".section-blue-bar").on("click",function(o){o.preventDefault(),e(".section-cta-inline").stop(0,0).slideToggle()}),e(".close-cta-section").on("click",function(o){o.preventDefault(),e(".section-cta-inline").slideUp()}),e(".live-chat-head").on("click",function(o){o.stopPropagation(),e(this).toggleClass("active"),e(this).closest(".live-chat").removeClass("active"),e(this).next(".live-chat-body").slideToggle()}),e(".live-chat-open").on("click",function(o){o.stopPropagation(),e(this).closest(".live-chat").addClass("active"),e(this).closest(".live-chat").find(".live-chat-head").addClass("active"),e(this).closest(".live-chat").find(".live-chat-body").slideDown()}),e(".live-chat-body").on("click",function(e){e.stopPropagation()}),r.on("click",function(){e(".live-chat-head").removeClass("active"),e(".live-chat-body").slideUp()}),e(".range-slider-inner").length&&(e(".range-slider-inner").slider({range:"min",min:0,max:10,value:3,step:1,slide:function(o,n){e("#medtour_rating_value").val(n.value)}}),e("#medtour_rating_value").val(e(".range-slider-inner").slider("value"))),e(".form-book-primary .btn-next").on("click",function(o){var n=!1,t=e(this).closest("form");o.preventDefault(),t.find(".required").not(".form-group-hidden .required").each(function(){this.value&&e(this).val()!==e(this).attr("placeholder")?e(this).removeClass("error").parent().removeClass("error"):(n=!0,e(this).addClass("error").parent().addClass("error"))}),e(".radio-required").length&&e(".radio-required").each(function(){e(this).find("input").is(":checked")?e(this).closest(".form-controls").removeClass("error"):(n=!0,e(this).closest(".form-controls").addClass("error"))}),n||(t.parent().addClass("expanded"),t.find(".field").not(".form-group-hidden .field").parent().removeClass("error").addClass("success"),t.find(".radio").closest(".form-controls").removeClass("error").addClass("success"))}),e(".link-share").on("click",function(n){n.preventDefault();var t=e(this).attr("href");o.open(t,"popupWindow","width=600,height=600,scrollbars=yes")}),e(".btn-filter").on("click",function(){e("body").addClass("show-filter")}),e(".btn-close-filter").on("click",function(o){o.preventDefault(),e("body").removeClass("show-filter")}),e(".btn-nav").on("click",function(){e(this).toggleClass("active"),e(".nav-mobile").toggleClass("opened")}),r.on("click",".nav-mobile .nav.cloned > ul > li > a",function(o){o.preventDefault(),e(this).parent().toggleClass("hover").siblings().removeClass("hover"),e(".nav-utilities.cloned li").removeClass("hover")}),r.on("click",".nav-mobile .has-subnav > a",function(o){o.preventDefault(),e(this).parent().toggleClass("hover").siblings().removeClass("hover"),e(".nav.cloned li").removeClass("hover")});var s=!1;e(".list-news-container .link-more").on("click",function(o){o.preventDefault(),s?(e(this).text(e(".see-more-article").html()),s=!1):(e(this).text(e(".see-less-article").html()),s=!0),e(this).closest(".list-news-actions").siblings(".list-news-hidden").slideToggle()}),function(){var o="accordion-expanded",n=".accordion-section",t=".accordion-head";e(".accordion-head").not(".no-description").on("click",function(){var o=e(this).find(".plus");o.closest(".accordion-section").hasClass("accordion-expanded")?o.text("+"):o.text("-")}),e(t).not(".no-description").on("click",function(){e(this).closest(n).toggleClass(o).siblings().removeClass(o),e(this).siblings(".accordion-body").slideToggle(),e(this).closest(".accordion-section").siblings().find(".accordion-body").slideUp(),e(this).closest(".accordion-section").siblings().find(".plus").text("+")}),e(".accordion-head a").on("click",function(e){e.stopPropagation()})}(),function(){var o="current";e(".tabs-nav a").on("click",function(n){var t=e(this),i=e(t.attr("href"));t.parent().add(i).addClass(o).siblings().removeClass(o),n.preventDefault()})}(),function(){e(n).on("click",".box-show",function(n){n.preventDefault(),n.stopPropagation(),e(o).scrollTop(0);var t=e(this).attr("href").substr(1);e(".menu-box").removeClass("visible"),e(".box-"+t).addClass("visible")}),e(n).on("click",function(o){e(o.target).parents(".menu-box").is("div")||e(".menu-box").removeClass("visible")})}(),e.fn.doPlaceholders=function(){if(e.support.placeholder)return this;var o=this.filter(function(){return!e(this).data("didPlaceholders")});return o.on("focus blur",function(e){var o=this.getAttribute("placeholder");"focus"===e.type&&o===this.value?this.value="":"blur"===e.type&&""===this.value&&(this.value=o)}),o.each(function(){""===this.value&&(this.value=this.getAttribute("placeholder"))}),o.data("didPlaceholders",!0),o},e.support.placeholder=function(){return"placeholder"in n.createElement("input")}(),e.support.placeholder||e("input[placeholder], textarea[placeholder]").doPlaceholders()})}(jQuery,window,document),function(){$(document).ready(function(){var e,o,n;return e="Desktop",isMobile&&(e="Mobile"),$("#search-form form").on("submit",function(o){var n,t,i,r,a;return o.preventDefault(),a=$("#search-form form #query_value").val()?$("#search-form form #query_value").val():"all",r={layout:e,version:"v3",user_logged_in:window.isLoggedin,query:a,inbound_country:$("#search-form form #select-country").val()?$("#search-form form #select-country").val():"all destinations"},window.location.href.indexOf("/difference/")>-1&&(r.value_proposition_version="v1",r.value_proposition_type=$(".intro-body-inner h1").text()),mixpanel.track("Search button clicked",r),a=$("#search-form form #query_value option:selected").text(),i=$("#search-form form #select-country option:selected").text(),mixpanel.track("Searched",{query:a,layout:e,inbound_country:i,url:window.location.href,version:2}),n=new Date,t=new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),0),mixpanel.people.set({"last search":t.toISOString()}),mixpanel.people.increment("number of searches"),setTimeout(function(){return $("#search-form form").unbind("submit").submit()},500)}),$(document).on("click",".box-clinic a",function(o){var n,t,i,r,a;return o.preventDefault(),a=$(this).attr("href"),i=$(this).attr("href"),n=$(this).parents(".box-clinic").find("h5 a").html(),t=i.lastIndexOf("/")+1,i=i.replace(i.substring(0,t),""),r=setTimeout(function(){return window.location.href=a},500),mixpanel.track("More details button clicked",{layout:e,version:"v3",user_logged_in:window.isLoggedin,query:window.location.pathname.replace("/search/",""),clinic_name:n,clinic_database_id:i},function(){return clearTimeout(r),window.location.href=a})}),$(".main .section-clinic").length>0&&(n="light",3===$(".scroll-group-head").length&&(n="full"),o={layout:e,profile_type:$(".section-clinic").data("type"),profile_page_version:"v1",picture_shown:$(".section-content img:first").attr("src"),specialty:$(".section-clinic").data("specialty"),profile_completion:n,user_logged_in:window.isLoggedin},mixpanel.track("Profile page loaded",o)),$(".section-head-actions a.back").on("click",function(o){var n,t;return o.preventDefault(),t=$(this).attr("href"),n=setTimeout(function(){return window.location.href=t},500),mixpanel.track("Return to search results button clicked",{layout:e,profile_type:$(".section-clinic").data("type"),specialty:$(".section-clinic").data("specialty"),user_logged_in:window.isLoggedin},function(){return clearTimeout(n),window.location.href=t})}),$(".ico-doctors, .ico-price, .ico-network, .ico-cares, .ico-doctors-small, .ico-price-small, .ico-cares-small, .ico-network-small").parent("a").on("click",function(){var n;return n=$(this).find("span").text(),o={layout:e,value_proposition_version:"v1",value_proposition_type:n,user_logged_in:window.isLoggedin},mixpanel.track("Value proposition clicked",o)}),$(".ico-doctors-tiny, .ico-price-tiny, .ico-network-tiny, .ico-cares-tiny, .ico-doctors-nav, .ico-price-nav, .ico-network-nav, .ico-cares-nav, .btn-learnmore span").parent("a").on("click",function(n){var t,i,r;return n.stopPropagation(),n.preventDefault(),r=$(this).find("span").text(),i=$(this).attr("href"),t=setTimeout(function(){return window.location.href=i},500),o={layout:e,value_proposition_version:"v1",value_proposition_type:r,user_logged_in:window.isLoggedin},mixpanel.track("Value proposition clicked",o,function(){return clearTimeout(t),window.location.href=i})}),$(".widget-clinic .btn-primary").on("click",function(o){var n,t;return o.preventDefault(),t=$(this).attr("href"),n=setTimeout(function(){return window.location.href=t},500),mixpanel.track("Find a provider button clicked",{layout:e,topic_page_type:$(".information-page").data("type"),topic_page_version:"v1",user_logged_in:window.isLoggedin},function(){return clearTimeout(n),window.location.href=t})})})}.call(this),function(){var e,o;e=window.isMobile?"Mobile":"Desktop",o={loggedIn:function(){return!!o.currentUser},mixpanelTrack:function(o,n){return mixpanel.track("Sign up page form filled out",{layout:e}),setTimeout(function(){return $.ajax({method:"POST",url:"/create_medtour_lead.json",data:{email:o}}),window.location.href=n},100)},login:function(e,o,n,t){return $.post("/users/sign_in.json",{user:{email:e,password:o}}).success(function(e){var o;return e.success?(o=window.isMedtour&&e.root_path||null===sessionStorage.getItem("redirectUrl")?e.root_path:sessionStorage.getItem("redirectUrl"),mixpanel.identify(""+e.user.user_id),n()):t()})},clearUser:function(){return o.currentUser=null},logout:function(){return o.clearUser(),mixpanel&&mixpanel.cookie&&mixpanel.cookie.clear(),$.ajax({type:"POST",url:"/users/sign_out.json",data:{_method:"delete"}}).success(function(){return window.location.href="/"})},register:function(e,n,t,i){return $.post("/users",{user:{email:e,password:n,password_confirmation:n,firstname:t,lastname:i}}).success(function(n){var r;return o.clearUser(),mixpanel.alias(""+n.user.user_id),mixpanel.people.set({$first_name:t,$last_name:i,$email:e,Location:$("#mobile-booking-register-form").data("location"),Specialty:$("#mobile-booking-register-form").data("specialty"),Booked:"false"}),$("#info_page_redirect").length>0?void(window.location.href=$("#info_page_redirect").val()):(r=window.isMedtour&&n.root_path||null===sessionStorage.getItem("redirectUrl")?n.root_path:sessionStorage.getItem("redirectUrl"),mixpanel.identify(""+n.user.user_id),o.mixpanelTrack(n.user.email,r))})},findShortUserName:function(){if(null!=o.currentUser&&null!=o.currentUser.user_email&&o.currentUser.user_first_name){if(!(o.currentUser.user_email.length>=8))return o.shortUserName=o.currentUser.email;if(o.shortUserName=o.currentUser.user_first_name||o.currentUser.email,o.shortUserName.length>=8&&(o.shortUserName=o.shortUserName.substring(0,8)+"..."),o.mobileShortName=o.currentUser.user_name,o.mobileShortName.length>=20)return o.mobileShortName=o.mobileShortName.substring(0,20)+"..."}else if(null!=o.currentUser&&null!=o.currentUser.user_email)return o.shortUserName=o.currentUser.user_email.substring(0,8),o.mobileShortName=o.currentUser.user_email.substring(0,2)},validateEmail:function(e){var o;return o=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,o.test(e)},changePassword:function(e,o){return $.ajax({method:"PUT",url:"/users/password.json",data:{user:{password:e,reset_password_token:o}}}).success(function(e){return e.success?($(".reset-password-error").hide(),mixpanel.identify(""+e.user.user_id),window.location.href="/"):$(".password-error").show()})}},this.CurrentUserService=o}.call(this),function(){var e,o,n;n=function(e){var o;return o=!0,e.find("input").each(function(){return $(this).val()?$(this).removeClass("dirty"):($(this).addClass("dirty"),o=!1)}),o},o=function(e){return $(e).show()},e=window.isMobile?"Mobile":"Desktop",$(function(){return $("#login-submit").on("click",function(t){var i,r,a,s;return t.preventDefault(),t.stopPropagation(),i=$("#field-login-email-address").val(),a=$("#field-login-password").val(),s=function(){return mixpanel.track("Login page form filled out",{layout:e}),setTimeout(function(){return $(".login-mobile").hide(),window.location.reload()},100)},r=function(e){return function(){return o($(e).closest("form").find(".notice.password-notice"))}}(this),n($(this).closest("form"))?CurrentUserService.login(i,a,s,r):void 0}),$("#field-login-email-address, #field-login-password").focus(function(){return $(this).removeClass("dirty"),$(this).closest("form").find(".password-notice").hide()}),$(".logout-link").on("click",function(){return CurrentUserService.logout()})})}.call(this),function(){$(function(){var e;return e=!1,$("#restore-form-user_email").on("keyup",function(){var e;return e=$(this).val(),0===e.length?($(".cannot-empty").show(),$(".email-invalid").hide(),$(".email-notice").hide(),$(this).addClass("ng-dirty ng-invalid")):($(".cannot-empty").hide(),CurrentUserService.validateEmail(e)?($(this).removeClass("ng-dirty ng-invalid"),$(".email-invalid").hide()):($(".email-invalid").show(),$(this).addClass("ng-dirty ng-invalid"))),0===$("#password-recovery-form .notice:visible").length?$("#password-recovery-form #forgot-password-submit").attr("disabled",!1):$("#password-recovery-form #forgot-password-submit").attr("disabled",!0)}),$("#password-recovery-form #forgot-password-submit").on("click",function(o){var n,t,i,r,a,s;if(o.preventDefault(),o.stopPropagation(),n=void 0,t=$("#restore-form-user_email").val(),$("#long-booking-doctor-box").length)for(n={return_date:encodeURIComponent($("#appointment-date").text()),return_time:encodeURIComponent($("#appointment-time").text()),return_doc:encodeURIComponent($("#long-booking-doctor-box").attr("data-doctor-slug"))},s=$("#login-form").serializeArray(),r=0,a=s.length;a>r;r++)i=s[r],n["return_"+i.name.replace("-","_")]=encodeURIComponent(i.value);return $.post("/users/password",$.extend({},{user:{email:t}},n)).success(function(n){var t;if(n.success){if(null===sessionStorage.getItem("redirectUrl"))try{sessionStorage.setItem("redirectUrl",n.root_path)}catch(t){if(o=t,!/QUOTA_?EXCEEDED/i.test(o.name))throw o}return $(".menu-box").is("div")?$(".menu-box").removeClass("visible"):e=!0}return $(".email-notice").text(n.errors[0]).show()}).error(function(){return $(".email-invalid").show()})}),$("#password-reset-form .btn-primary").on("click",function(e){var o,n,t;return e.preventDefault(),e.stopPropagation(),$(".reset-password-error").hide(),o=$("#password-input").val(),n=$("#password-confirmation-input").val(),t=window.location.search.split("=")[1],o!==n?$(".confirmed-error").show():6>o?$(".password-error").show():CurrentUserService.changePassword(o,t)})})}.call(this),function(){var e,o,n,t,i;t=function(n,t){return 0===t.length?o(n,".cannot-empty"):e(n,".cannot-empty")},n=function(n,t){return t.length>0&&"email"===$(n).attr("type")&&!CurrentUserService.validateEmail(t)?o(n,".incorrect-email"):e(n,".incorrect-email")},i=function(n,t){return t.length>0&&"password"===$(n).attr("type")&&t.length<6?o(n,".incorrect-password"):e(n,".incorrect-password")},o=function(e,o){return $(e).closest(".form-controls").find(o).show()},e=function(e,o){return $(e).closest(".form-controls").find(o).hide()},$(function(){return $(".form-register input").on("keyup",function(){var e;return e=$(this).val(),$(this).addClass("ng-dirty"),t(this,e),n(this,e),i(this,e),$(this).closest(".form-controls").find(".notice:visible").length>0?$(this).addClass("ng-invalid"):$(this).removeClass("ng-invalid"),$(".form-register input.ng-invalid").length>0||$(".form-register input.ng-dirty").length<4?$(".form-register #register-submit").attr("disabled",!0):$(".form-register #register-submit").attr("disabled",!1)}),$(".form-register #register-submit").on("click",function(e){var o,n,t,i;e.preventDefault(),e.stopPropagation(),o=$("#field-reg-email").val(),i=$("#field-reg-password").val(),n=$("#field-reg-given-name").val(),t=$("#field-reg-family-name").val(),$.post("/users/check_email_presence.json",{value:o}).success(function(e){return e.success?$(".form-register .email-taken").show():$(".form-register input.ng-invalid")?($(".menu-box").is("div")&&($(".menu-box").removeClass("visible"),$(".box-thanks").addClass("visible")),CurrentUserService.register(o,i,n,t)):void 0}).error(function(){return $(".form-register .email-taken").show()})})})}.call(this),window.bindDelaconPhoneNumberLink=function(){$("#numdiv_"+window.delaconCid+"_0").length>0&&$(".tracking-phone-num").each(function(){var e=$("#numdiv_"+window.delaconCid+"_0").text();if(""==e)return setTimeout(bindDelaconPhoneNumberLink,500),!1;e.match(/^\+65/)||(e="+65 "+e);var o=e.split(" ").join("");$(this).parents("a").attr("href","tel:"+o),$(this).html(e)})},$(window).ready(function(){bindDelaconPhoneNumberLink()});